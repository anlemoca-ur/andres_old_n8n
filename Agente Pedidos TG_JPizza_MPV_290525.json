{
  "active": true,
  "activeVersion": {
    "updatedAt": "2025-12-03T01:55:24.502Z",
    "createdAt": "2025-12-03T01:55:24.502Z",
    "versionId": "bd44da4c-4927-4f17-86bc-2e5f3a6759b8",
    "workflowId": "KlsfNgdgN4KP1aud",
    "nodes": [
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "message_text"
              },
              {
                "name": "message_from"
              },
              {
                "name": "message_timestamp",
                "type": "number"
              },
              {
                "name": "message_id",
                "type": "number"
              },
              {
                "name": "message_state"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -480,
          -80
        ],
        "id": "945cac38-bb93-4e69-b511-5cb8a0531e11",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "operation": "upsert",
          "schema": {
            "__rl": true,
            "value": "public",
            "mode": "list",
            "cachedResultName": "public"
          },
          "table": {
            "__rl": true,
            "value": "historial_ordenes_juniorspizza",
            "mode": "list",
            "cachedResultName": "historial_ordenes_juniorspizza"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id": "={{ $json.message_id }}",
              "message_text": "={{ $json.message_text }}",
              "message_from": "={{ $json.message_from }}",
              "message_timestamp": "={{ $json.message_timestamp }}",
              "message_state": "={{ $json.message_state }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "message_from",
                "displayName": "message_from",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              },
              {
                "id": "message_text",
                "displayName": "message_text",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              },
              {
                "id": "message_timestamp",
                "displayName": "message_timestamp",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              },
              {
                "id": "message_state",
                "displayName": "message_state",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -200,
          -80
        ],
        "id": "3b11268e-5b9f-4d05-8fe7-375c945b20ea",
        "name": "Postgres",
        "credentials": {
          "postgres": {
            "id": "K1LA3eNGbED7IBfW",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.message_state }}",
                      "rightValue": "processing",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "c2accb12-f36f-4e17-8e40-092e6f0a9776"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "processing"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "813a6047-1ca2-4238-aa6c-f291fdb02c5b",
                      "leftValue": "={{ $json.message_state }}",
                      "rightValue": "ready",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "ready"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8df39786-ec5a-4fea-9707-cf50894d44d8",
                      "leftValue": "={{ $json.message_state }}",
                      "rightValue": "+10 minutes",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "10 minutes"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          60,
          -80
        ],
        "id": "367cb59b-f856-4c38-aee8-d8c2b65a2d25",
        "name": "Switch"
      },
      {
        "parameters": {
          "chatId": "7839880794",
          "text": "={{ $json.message_text }} ",
          "replyMarkup": "inlineKeyboard",
          "inlineKeyboard": {
            "rows": [
              {
                "row": {
                  "buttons": [
                    {
                      "text": "Ready",
                      "additionalFields": {
                        "callback_data": "=\"id\":{{ $json.message_timestamp.toJsonString() }}\n\"from\":{{ $json.message_from.toJsonString()}}\n\"state\":ready"
                      }
                    },
                    {
                      "text": "+10 minutes",
                      "additionalFields": {
                        "callback_data": "=\"id\":{{ $json.message_timestamp.toJsonString() }}\n\"from\":{{ $json.message_from.toJsonString()}}\n\"state\":+10 minutes"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {
            "appendAttribution": false
          },
          "path": "de7b4034-f8b1-4248-8017-10c180237f0d"
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          400,
          -240
        ],
        "id": "3a9171b0-9d69-49e0-9fd1-e7e75ee72c3e",
        "name": "processing",
        "webhookId": "de7b4034-f8b1-4248-8017-10c180237f0d",
        "credentials": {
          "telegramApi": {
            "id": "Sjzzj8rExvqd1tes",
            "name": "Telegram account"
          }
        }
      },
      {
        "parameters": {
          "operation": "editMessageText",
          "chatId": "7839880794",
          "messageId": "={{ $json.id }}",
          "text": "={{ $('Postgres').item.json.message_text }}\nstate: ready",
          "additionalFields": {},
          "path": "0a78b866-f642-4cee-90ff-25891277e98b"
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          400,
          -40
        ],
        "id": "d127d60e-0f83-4ccd-812b-3a722391c26e",
        "name": "ready",
        "webhookId": "0a78b866-f642-4cee-90ff-25891277e98b",
        "credentials": {
          "telegramApi": {
            "id": "Sjzzj8rExvqd1tes",
            "name": "Telegram account"
          }
        }
      },
      {
        "parameters": {
          "operation": "editMessageText",
          "chatId": "7839880794",
          "messageId": "={{ $json.id }}",
          "replyMarkup": "inlineKeyboard",
          "text": "={{ $json.message_text}}\nState: +10 minutes",
          "inlineKeyboard": {
            "rows": [
              {
                "row": {
                  "buttons": [
                    {
                      "text": "Ready",
                      "additionalFields": {
                        "callback_data": "=\"id\":{{ $json.message_timestamp.toJsonString() }}\n\"from\":{{ $json.message_from.toJsonString()}}\n\"state\":ready"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "additionalFields": {},
          "path": "b910e393-9061-4422-a55a-06595518ba69"
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          400,
          180
        ],
        "id": "2ad67987-4551-4b36-9029-b0d23480bb63",
        "name": "+ 10 min",
        "webhookId": "b910e393-9061-4422-a55a-06595518ba69",
        "credentials": {
          "telegramApi": {
            "id": "Sjzzj8rExvqd1tes",
            "name": "Telegram account"
          }
        }
      },
      {
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {},
          "path": "848bbbe6-58da-4051-af5d-522aa58feb3d"
        },
        "type": "n8n-nodes-base.telegramTrigger",
        "typeVersion": 1.2,
        "position": [
          -480,
          200
        ],
        "id": "374d2d48-c97e-4d05-8360-afff18f079da",
        "name": "Crear Chat",
        "webhookId": "848bbbe6-58da-4051-af5d-522aa58feb3d",
        "credentials": {
          "telegramApi": {
            "id": "Sjzzj8rExvqd1tes",
            "name": "Telegram account"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "content": "7839880794 chat telegram",
          "height": 220,
          "width": 260
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -540,
          160
        ],
        "id": "5f5d8cca-be38-4c23-be94-86adf44d0078",
        "name": "Sticky Note"
      }
    ],
    "connections": {
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Postgres",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "processing",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ready",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "+ 10 min",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ready": {
        "main": [
          []
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2025-05-29T14:42:50.520Z",
        "id": 1,
        "workflowId": "KlsfNgdgN4KP1aud",
        "versionId": "bd44da4c-4927-4f17-86bc-2e5f3a6759b8",
        "event": "activated",
        "userId": null
      }
    ]
  },
  "activeVersionId": "bd44da4c-4927-4f17-86bc-2e5f3a6759b8",
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Postgres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "processing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ready",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "+ 10 min",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ready": {
      "main": [
        []
      ]
    }
  },
  "createdAt": "2025-05-29T14:42:15.251Z",
  "description": null,
  "id": "KlsfNgdgN4KP1aud",
  "isArchived": true,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Agente Pedidos TG_JPizza_MPV_290525",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "message_text"
            },
            {
              "name": "message_from"
            },
            {
              "name": "message_timestamp",
              "type": "number"
            },
            {
              "name": "message_id",
              "type": "number"
            },
            {
              "name": "message_state"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -480,
        -80
      ],
      "id": "945cac38-bb93-4e69-b511-5cb8a0531e11",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "historial_ordenes_juniorspizza",
          "mode": "list",
          "cachedResultName": "historial_ordenes_juniorspizza"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.message_id }}",
            "message_text": "={{ $json.message_text }}",
            "message_from": "={{ $json.message_from }}",
            "message_timestamp": "={{ $json.message_timestamp }}",
            "message_state": "={{ $json.message_state }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "message_from",
              "displayName": "message_from",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "message_text",
              "displayName": "message_text",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "message_timestamp",
              "displayName": "message_timestamp",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            },
            {
              "id": "message_state",
              "displayName": "message_state",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -200,
        -80
      ],
      "id": "3b11268e-5b9f-4d05-8fe7-375c945b20ea",
      "name": "Postgres",
      "credentials": {
        "postgres": {
          "id": "K1LA3eNGbED7IBfW",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message_state }}",
                    "rightValue": "processing",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c2accb12-f36f-4e17-8e40-092e6f0a9776"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "processing"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "813a6047-1ca2-4238-aa6c-f291fdb02c5b",
                    "leftValue": "={{ $json.message_state }}",
                    "rightValue": "ready",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ready"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8df39786-ec5a-4fea-9707-cf50894d44d8",
                    "leftValue": "={{ $json.message_state }}",
                    "rightValue": "+10 minutes",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "10 minutes"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        60,
        -80
      ],
      "id": "367cb59b-f856-4c38-aee8-d8c2b65a2d25",
      "name": "Switch"
    },
    {
      "parameters": {
        "chatId": "7839880794",
        "text": "={{ $json.message_text }} ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ready",
                    "additionalFields": {
                      "callback_data": "=\"id\":{{ $json.message_timestamp.toJsonString() }}\n\"from\":{{ $json.message_from.toJsonString()}}\n\"state\":ready"
                    }
                  },
                  {
                    "text": "+10 minutes",
                    "additionalFields": {
                      "callback_data": "=\"id\":{{ $json.message_timestamp.toJsonString() }}\n\"from\":{{ $json.message_from.toJsonString()}}\n\"state\":+10 minutes"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        },
        "path": "de7b4034-f8b1-4248-8017-10c180237f0d"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        400,
        -240
      ],
      "id": "3a9171b0-9d69-49e0-9fd1-e7e75ee72c3e",
      "name": "processing",
      "webhookId": "de7b4034-f8b1-4248-8017-10c180237f0d",
      "credentials": {
        "telegramApi": {
          "id": "Sjzzj8rExvqd1tes",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "7839880794",
        "messageId": "={{ $json.id }}",
        "text": "={{ $('Postgres').item.json.message_text }}\nstate: ready",
        "additionalFields": {},
        "path": "0a78b866-f642-4cee-90ff-25891277e98b"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        400,
        -40
      ],
      "id": "d127d60e-0f83-4ccd-812b-3a722391c26e",
      "name": "ready",
      "webhookId": "0a78b866-f642-4cee-90ff-25891277e98b",
      "credentials": {
        "telegramApi": {
          "id": "Sjzzj8rExvqd1tes",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "7839880794",
        "messageId": "={{ $json.id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "={{ $json.message_text}}\nState: +10 minutes",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ready",
                    "additionalFields": {
                      "callback_data": "=\"id\":{{ $json.message_timestamp.toJsonString() }}\n\"from\":{{ $json.message_from.toJsonString()}}\n\"state\":ready"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {},
        "path": "b910e393-9061-4422-a55a-06595518ba69"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        400,
        180
      ],
      "id": "2ad67987-4551-4b36-9029-b0d23480bb63",
      "name": "+ 10 min",
      "webhookId": "b910e393-9061-4422-a55a-06595518ba69",
      "credentials": {
        "telegramApi": {
          "id": "Sjzzj8rExvqd1tes",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {},
        "path": "848bbbe6-58da-4051-af5d-522aa58feb3d"
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -480,
        200
      ],
      "id": "374d2d48-c97e-4d05-8360-afff18f079da",
      "name": "Crear Chat",
      "webhookId": "848bbbe6-58da-4051-af5d-522aa58feb3d",
      "credentials": {
        "telegramApi": {
          "id": "Sjzzj8rExvqd1tes",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "7839880794 chat telegram",
        "height": 220,
        "width": 260
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -540,
        160
      ],
      "id": "5f5d8cca-be38-4c23-be94-86adf44d0078",
      "name": "Sticky Note"
    }
  ],
  "pinData": {
    "Crear Chat": [
      {
        "json": {
          "update_id": 315589294,
          "message": {
            "message_id": 40,
            "from": {
              "id": 6929772961,
              "is_bot": false,
              "first_name": "Andrés",
              "last_name": "Mora",
              "username": "Anlemoca",
              "language_code": "en"
            },
            "chat": {
              "id": 6929772961,
              "first_name": "Andrés",
              "last_name": "Mora",
              "username": "Anlemoca",
              "type": "private"
            },
            "date": 1747090949,
            "text": "Aquí"
          }
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-05-29T14:42:15.251Z",
      "createdAt": "2025-05-29T14:42:15.251Z",
      "role": "workflow:owner",
      "workflowId": "KlsfNgdgN4KP1aud",
      "projectId": "bMLPVLxvJNyYpOg4",
      "project": {
        "updatedAt": "2025-04-10T19:37:33.834Z",
        "createdAt": "2025-04-10T19:34:51.491Z",
        "id": "bMLPVLxvJNyYpOg4",
        "name": "andres mora <anlemoca.pm@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "1be52bcb-fd69-4000-ad4f-8a9b9553dae7",
        "projectRelations": [
          {
            "updatedAt": "2025-04-10T19:34:51.491Z",
            "createdAt": "2025-04-10T19:34:51.491Z",
            "userId": "1be52bcb-fd69-4000-ad4f-8a9b9553dae7",
            "projectId": "bMLPVLxvJNyYpOg4",
            "user": {
              "updatedAt": "2026-02-13T18:26:13.532Z",
              "createdAt": "2025-04-10T19:34:49.729Z",
              "id": "1be52bcb-fd69-4000-ad4f-8a9b9553dae7",
              "email": "anlemoca.pm@gmail.com",
              "firstName": "andres",
              "lastName": "mora",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-04-10T19:39:59.967Z",
                "personalization_survey_n8n_version": "1.86.1",
                "automationGoalDevops": [
                  "data-syncing",
                  "monitoring-alerting"
                ],
                "companySize": "<20",
                "companyType": "systems-integrator",
                "role": "it",
                "reportedSource": "friend"
              },
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "UvY47ZI6TkdR3EGX",
                "userActivatedAt": 1748458737814,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1764727678159
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-02-13",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-04-19T14:32:24.162Z",
      "createdAt": "2025-04-19T14:32:24.162Z",
      "id": "g3NaHHARog1Wx0jT",
      "name": "Comida con Menú"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-05-29T14:42:50.520Z",
  "versionCounter": 3,
  "versionId": "bd44da4c-4927-4f17-86bc-2e5f3a6759b8"
}